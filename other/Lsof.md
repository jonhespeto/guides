▪️ Удаленный файл занимает место, такие файлы будет видно вот так:
```bash
lsof | grep '(deleted)'
```
или так:
```bash
lsof +L1
```
▪️ Смотрим кем и что конкретно открыто из файлов в указанной директории:
```bash
lsof +D /var/log
```
▪️ Смотрим открытые файлы конкретного пользователя:
```bash
lsof -u user
```
▪️ Часто бывает нужно быстро узнать, сколько файлов у него открыто, чтобы понять, если с ним проблема или нет:
```bash
lsof -u user | wc -l
```
▪️ А теперь то же самое, только наоборот исключим открытые файлы пользователя:
```bash
lsof -u^user | wc -l
```
▪️ Рассмотрим ситуацию, когда под пользователем плодятся процессы, которые открывают кучу файлов и нам всё это надо быстро прибить. Добавляем ключ -t к lsof, который позволяет выводить только PID процессов. И отправляем вывод в kill:
```bash
kill -9 `lsof -t -u user`
```
▪️ Файлы, открытые конкретным процессом, для которого указан его PID. Очень востребованная функциональность.
```bash
lsof -p 94169
```
▪️ А теперь немного того, что от lsof не ожидаешь. Список TCP соединений, причём очень наглядный и удобный для восприятия.
```bash
lsof -ni
```
▪️ Смотрим подробную информацию о том, кто открыл 80-й порт:
```bash
lsof -ni TCP:80  
```
▪️ Список TCP соединений к конкретному IP адресу:
```bash
lsof -ni TCP@172.29.139.228
```
▪️ Список TCP соединений конкретного пользователя:
```bash
lsof -ai -u nginx
```
▪️ Помимо TCP, можно и UDP соединения смотреть:
```bash
lsof -iUDP
```